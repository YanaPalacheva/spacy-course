---
type: slides
---

# Статистические модели

Notes: Давайте снабдим объект `nlp` новыми возможностями!

В этом уроке вы узнаете о статистических моделях spaCy.

---

# Что представляют из себя статистические модели?

- Дают возможность spaCy предсказывать лингвистические атрибуты учитывая _контекст_
  - Части речи
  - Синтаксические роли
  - Именованные сущности
- Натренированы на размеченных текстах
- Могут быть дополнены новыми данными, чтобы улучшить предсказания

Notes: Задачи, представляющие наибольший интерес, часто контестно-зависимые: определить, 
например, является ли данное слово глаголом или спан текста - каким-то именем собственным.

Статистические модели позволяют spaCy учитывать контекст при предсказаниях. Обычно
это касается определения частей речи, синтаксических ролей и распознавания именованных сущностей.

Модели натренированы на больших массивах размеченных текстов.

Чтобы улучшить качество предсказаний, модели можно дополнить новыми вхождениями:
это может помочь при работе с конкретно вашими данными.

---

# Пакеты моделей

<img src="/package.png" alt="A package with the label en_core_web_sm" width="30%" align="right" />

```bash
$ python -m spacy download en_core_web_sm
```

```python
import spacy

nlp = spacy.load("en_core_web_sm")
```

- Матрица весов
- Вокабуляр
- Метаданные (язык, компоненты пайплайна)

spaCy предоставляет несколько предварительно обученных моделей, которые можно загрузить как пакеты
с помощью команды `spacy download`. К примеру, пакет "en_core_web_sm" содержит
небольшую модель для английского языка, которая была обучена на текстах из сети и 
поддерживает все ключевые возможности.

Загрузить пакет с моделью можно с помощью метода `spacy.load`: он принимает на вход имя модели 
и возвращает объект `nlp`.

Такой пакет также включает в себя матрицу весов, которая позволяет spaCy делать предсказания.

Кроме того, в него входят вокабуляр и метаданные, которые сообщают spaCy, 
класс какого языка нужно использовать и как построить пайплайн обработки.

---

# Предсказание частей речи

```python
import spacy

# Загрузка небольшой модели для английского языка
nlp = spacy.load("en_core_web_sm")

# Обработка текста
doc = nlp("She ate the pizza")

# Перебор токенов
for token in doc:
    # Вывод текстового значения токена и части речи, предсказанной для него моделью
    print(token.text, token.pos_)
```

```out
She PRON
ate VERB
the DET
pizza NOUN
```

Notes: Давайте посмотрим на то, как модель делает предсказания. 
В этом примере мы используем spaCy для предсказания частей речи слов в контексте.

Сначала мы загружаем небольшую модель для английского языка и 
создаём объект `nlp`.

На следующем шаге мы обрабатываем текст "She ate the pizza" ("Она ела пиццу"). 

Дальше мы выводим текстовое значение каждого токена и значение его атрибута `.pos_`,
который хранит предсказанную для этого токена часть речи.

В spaCy атрибуты, имена которых заканчиваются нижним подчёркиванием, 
обычно содержат строки, в то время как атрибуты без нижнего подчёркивания в имени 
содержат целочисленные значения.

В данном примере, модель сделала верные предсказания для глагола "ate"("ела")  и 
существительного "pizza"("пицца").

---

# Предсказание синтаксических ролей

```python
for token in doc:
    print(token.text, token.pos_, token.dep_, token.head.text)
```

```out
She PRON nsubj ate
ate VERB ROOT ate
the DET det pizza
pizza NOUN dobj ate
```

Notes: Помимо частей речи, мы имеем возможность узнать, как слова в предложении 
соотносятся друг с другом. К примеру, мы можем предсказать, является ли слово подлежащим или дополнением. 

Атрибут `.dep_` содержит предсказанную синтаксическую роль слова.

Атрибут `.head` хранит ссылку на главный токен, иными словами родительский токен, 
для которого текущий токен является зависимым.

---

# Схема синтаксического аннотирования

<img src="/dep_example.png" alt="Visualization of the dependency graph for 'She ate the pizza'" />

| Аннотация | Описание               | Пример  |
| --------- | ---------------------- | ------- |
| **nsubj** | подлежащее             | She     |
| **dobj**  | прямое дополнение      | pizza   |
| **det**   | артикль                | the     |

Notes: Для описания синтаксических зависимостей spaCy использует 
стандартизированную схему аннотирования. Ниже приведены примеры некоторых общепринятых аннотаций:

Местоимение "She" ("она") является подлежащим, присоединённым к глаголу "ate" ("ела") в данном случае.

Существительное "pizza" ("пицца") является прямым дополнением к глаголу "ate" ("ела").
Пицца была съедена подлежащим "she" ("она").

Артикль "the" присоединён к существительному "pizza" ("пицца").

---

# Предсказание именованных сущностей

<img src="/ner_example.png" alt="Visualization of the named entities in 'Apple is looking at buying U.K. startup for $1 billion'" width="80%" />

```python
# Обработка текста
doc = nlp("Apple is looking at buying U.K. startup for $1 billion")

# Перебор предсказанных именованных сущностей
for ent in doc.ents:
    # Вывод текстового значения сущности и её аннотации
    print(ent.text, ent.label_)
```

```out
Apple ORG
U.K. GPE
$1 billion MONEY
```

Notes: Именованные сущности - это объекты "реального мира", у которых есть имена: 
люди, организации, страны.

С помощью `doc.ents` можно получить список именованных сущностей, предсказанных 
моделью для данного документа.

Этот список является последовательностью объектов `Span`, что позволяет нам 
выводить текстовое значение именованной сузности и её аннотацию с помощью атрибута `.label_`.

В данном примере модель корректно определила "Apple" как организацию,
"U.K." ("Великобритания") как геополитическую сущность 
и "\$1 billion" ("1 миллиард долларов") как денежную величину.

---

# Полезное: метод spacy.explain

Возможность получить краткое определение самых распространённых аннотаций.

```python
# определение spaCy: 'Страны, города, государства'
spacy.explain("GPE")
```

```out
'Countries, cities, states'
```

```python
# определение spaCy: 'имя собственное, ед. число'
spacy.explain("NNP")
```

```out
'noun, proper singular'
```

```python
# определение spaCy: 'прямое дополнение'
spacy.explain("dobj")
```

```out
'direct object'
```

Notes: Небольшой совет: чтобы получить краткое определение самых распространённых аннотаций, 
можно воспользоваться вспомогательным методом `spacy.explain`.

Например, аннотация "GPE" обозначает геополитическую сущность, что сложно назвать 
интуитивно понятным, однако, `spacy.explain` показывает, что она 
имеет отношение к странам, городам и государствам.

Также это работает для частей речи и синтаксических аннотаций.

---

# Давайте потренируемся!

Notes: Теперь ваша очередь. Давайте опробуем статистические модели spaCy на практике.
