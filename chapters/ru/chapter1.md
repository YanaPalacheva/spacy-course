---
title: 'Глава 1: Нахождение слов, фраз, названий и концептов'
description:
  "Эта глава познакомит вас с основами обработки текста с помощью spaCy.
   Вы узнаете о структурах данных и научитесь определять лингвистические характеристики текста 
   с помощью статистических моделей."
prev: null
next: /chapter2
type: chapter
id: 1
---

<exercise id="1" title="Введение в spaCy" type="slides,video">

<slides source="chapter1_01_introduction-to-spacy" start="0:165" end="3:01">
</slides>

</exercise>

<exercise id="2" title="Первые шаги">

Давайте приступим и посмотрим на spaCy в действии! В этом упражнении вы 
сможете опробовать некоторые из 55+ [доступных языков](https://spacy.io/usage/models#languages).

### Часть 1: Английский

- Импортируйте класс `English` из `spacy.lang.en` и создайте объект `nlp`.
- Создайте объект `doc` и выведите его текстовое значение.

<codeblock id="01_02_01"></codeblock>

### Часть 2: Немецкий

- Импортируйте класс `German` из `spacy.lang.de` и создайте объект `nlp`.
- Создайте объект `doc` и выведите его текстовое значение.

<codeblock id="01_02_02"></codeblock>

### Часть 3: Испанский

- Импортируйте класс `Spanish` из `spacy.lang.es` и создайте объект `nlp`.
- Создайте объект `doc` и выведите его текстовое значение.

<codeblock id="01_02_03"></codeblock>

</exercise>

<exercise id="3" title="Документы, спаны и токены">

Чтобы создать документ, необходимо послать текстовую строку в объект `nlp` в качестве аргумента: 
spaCy разобьёт текст на токены и вернёт готовый документ. В этом упражнении вы узнаете больше как об
объекте `Doc`, так и о вариантах его представления:  объектах `Token` и `Span`.

### Шаг 1

- Импортируйте класс `English` из `spacy.lang.en` и создайте объект `nlp`.
- Обработайте с помощью него текст и создайте экземпляр объекта `Doc`, сохраните его в переменную `doc`.
- Получите первый токен документа `Doc` и выведите его текстовое значение `text`.

<codeblock id="01_03_01">

Перебор элементов объекта `Doc` осуществляется по аналогии со списками в Python.
Например, `doc[4]` вернёт токен на позиции 4, то есть пятый токен текста. 
Не забывайте, что нумерация индексов в Python начинается с 0, а не с 1.

</codeblock>

### Шаг 2

- Импортируйте класс `English` из `spacy.lang.en` и создайте объект `nlp`.
- Обработайте с помощью него текст и создайте экземпляр объекта `Doc`, сохраните его в переменную `doc`.
- Создайте срез объекта `Doc`, соответствующий токенам "tree kangaroos" и "tree
  kangaroos and narwhals".

<codeblock id="01_03_02">

Срез объекта `Doc` создаётся так же, как и срез списка в Python: с помощью оператора `:`.
Не забывайте, что последний индекс _не включается_ в срез. Например, `0:4` описывает токены 
с позиции 0 _до_ 4, не включая токен на позиции 4.

</codeblock>

</exercise>

<exercise id="4" title="Лексические атрибуты">

Цель этого упражнения - найти упоминания процентов в тексте, искользуя объекты `Doc` и `Token`, 
а также лексические атрибуты. Нужно найти последовательности из двух токенов: числа и знака процента.

- Проверьте с помощью атрибута `like_num`, соответствует ли токен из `doc` числу.
- Получите токен, _следующий_ за текущим. Его инжекс в документе `doc` - `token.i + 1`.
- Проверьте, является ли значение атрибута `text` следующего токена знаком процента "%".

<codeblock id="01_04">

Чтобы узнать, какой токен стоит на конкретной позиции, можно получить его по индексу
из `doc`. Например, `doc[5]` вернёт токен на позиции 5.

</codeblock>

</exercise>

<exercise id="5" title="Статистические модели" type="slides,video">

<slides source="chapter1_02_statistical-models" start="3:12" end="7:01">
</slides>

</exercise>

<exercise id="6" title="Пакеты моделей" type="choice">

Что **не** является частью модели, загружаемой в spaCy отдельным пакетом?

<choice>
<opt text="Файл с метаданными по языку, компонентам пайплайна и лицензии">

Все модели содержат файл `meta.json`. Он сообщает spaCy, какой язык нужно инициализировать,
какие компоненты пайплайна загружать, а также содержит такие метаданные, как название модели,
версия, тип лицензии, источники данных, имя автора и оценку правильности предсказаний (если есть).

</opt>
<opt text="Матрица весов для статистических предсказаний.">

Чтобы уметь предсказывать такие лингвистические характеристики, как части речи слов,
их синтаксические роли, распознавать именованные сущности, модели необходимо хранить матрицу весов.

</opt>
<opt correct="true" text="Размеченные данные, на которых модель была обучена">

Статистические модели позволяют делать предсказания на основе тренировочных данных 
с помощью матрицы весов. Поэтому нет необходимости снабжать готовую модель тренировочными данными.

</opt>
<opt text="Строки, содержащие единицы вокабуляра модели и соответствующие им хэши">

В пакет модели входит файл `strings.json`, который хранит единицы вокабуляра модели и
соотвествующие им значения хэшей. Это позволяет spaCy оперировать исключительно хэшами и
обращаться к соответсвующей строке только в случае необходимости.

</opt>
</choice>

</exercise>

<exercise id="7" title="Загрузка моделей">

Все модели, которые мы будем использовать в этом курсе, уже предустановлены. 
Более подробную информацию о статистических моделях spaCy и способах их установки 
можно найти в [документации](https://spacy.io/usage/models).

- Используйте `spacy.load`, чтобы загрузить небольшую модель для английского языка `"en_core_web_sm"`.
- Обработайте текст и выведите документ на печать

<codeblock id="01_07">

Чтобы загрузить модель, вызовите метод `spacy.load` с названием модели в качестве параметра. 
Названия моделей различаются в зависимости от того, на каких данных они были обучены,
поэтому убедитесь, что вы используете правильное название.

</codeblock>

</exercise>

<exercise id="8" title="Предсказание лингвистических характеристик текста">

В этом упражнении вы сможете посмотреть на одну из предобученных моделей spaCy 
в действии. Не забудьте опробовать её на собственном тексте! Чтобы узнать, 
что означает та или иная аннотация, вы можете вызвать метод `spacy.explain`. 
Например, `spacy.explain("PROPN")` или `spacy.explain("GPE")`.

### Часть 1

- Обработайте текст с помощью объекта `nlp` и создайте `doc`.
- Выведите для каждого токена его текстовое значение, часть речи `.pos_` и 
его синтаксическую роль `.dep_`.

<codeblock id="01_08_01">

Объект `doc` является результатом обработки текста объектом `nlp`. Не забудьте, что 
строковые значения хранят атрибуты, имена которых заканчиваются нижним подчёркиванием.

</codeblock>

### Часть 2

- Обработайте текст и создайте `doc`.
- Выведите текстовые значения и атрибуты `label_` всех именованных сущностей из `doc.ents` в цикле.

<codeblock id="01_08_02">

Объект `doc` является результатом обработки текста объектом `nlp`. Не забудьте, что 
строковые значения хранят атрибуты, имена которых заканчиваются нижним подчёркиванием.

</codeblock>

</exercise>

<exercise id="9" title="Предсказание именованных сущностей в контексте">

Модели основаны на статистике, поэтому не могут быть правы _всегда_. Качество их 
предсказаний зависит и от тренировочных данных, и от текста, подаваемого на вход. 
Давайте убедимся в этом на примере.

- Обработайте текст с помощью объекта `nlp`.
- Выведите текстовые значения и аннотации именованных сущностей в цикле.
- Модели не удалось предсказать "iPhone X". Создайте спан для этих токенов вручную.

<codeblock id="01_09">

- Объект `doc` является результатом обработки текста объектом `nlp`. Доступ к списку 
  именованных сущностей можно получить с помощью `doc.ents`.
- Самый простой способ создать объект `Span` - это использовать срез: например, 
  `doc[5:10]` является срезом токенов с позиции 5 _до_ 10. Не забывайте, что 
  токен на последней позиции не включается в срез.
  
</codeblock>

</exercise>

<exercise id="10" title="Поиск совпадений по шаблонам" type="slides,video">

<slides source="chapter1_03_rule-based-matching" start="7:118" end="10:55">
</slides>

</exercise>

<exercise id="11" title="Использование матчера">

Давайте опробуем `Matcher` в деле. Вы будете использовать пример 
из предыдущего упражнения: вам нужно написать шаблон, которому соответствует 
фраза "iPhone X".

- Импортируйте класс `Matcher` из `spacy.matcher`.
- Инициализируйте матчер с общим вокабуляром `vocab` объекта `nlp` в качестве аргумента.
- Создайте шаблон, описывающий значения `"TEXT"` следующих двух токенов: 
  `"iPhone"` и `"X"`.
- С помощью метода `matcher.add` добавьте шаблон в матчер.
- Вызовите матчер с документом `doc` в качестве аргумента 
  и сохраните результат в переменную `matches`.
- Переберите все найденные соответствия в цикле и получите
  для каждого из них спан: срез с от позиции `start` до позиции `end`.

<codeblock id="01_11">

- Общий вокабуляр можно получить с помощью атрибута `nlp.vocab`.
- Шаблон представляет собой список словарей, ключами для которых служат имена атрибутов.
  Например, шаблону `[{"TEXT": "Hello"}]` будет соответствовать один токен с текстовым 
  значением "Hello".
- Значения `start` и `end` каждого найденного совпадения обозначают начальный и конечный индекс 
  соответствующего спана в документе. Чтобы получить спан, можно создать срез документа `doc`, 
  используя эти значения.

</codeblock>

</exercise>

<exercise id="12" title="Написание шаблонов">

Это упражнение заключается в написании более сложных шаблонов 
с использованием различных атрибутов токенов и операторов.

### Часть 1

- Напишите **один** шаблон, которому будут соответствовать _полные_ имена 
  версий iOS: "iOS 7", "iOS 11" и "iOS 10".

<codeblock id="01_12_01">

- Чтобы найти токен по точному сопадению текста, используйте атрибут `TEXT`.
  Например, шаблону `{"TEXT": "Apple"}` будут соответствовать токены с текстовым 
  значением "Apple".
- Чтобы найти токен, соответствующий числу, используйте атрибут `"IS_DIGIT"`.
  Его значение равно `True` только у токенов, состоящих из цифр.

</codeblock>

### Часть 2

- Напишите **один** шаблон, которому будут соответствовать следующие последовательности: 
  токен с леммой "download", за которым следует токен с частью речи `"PROPN"` (имя собственное).

<codeblock id="01_12_02">

- Чтобы задать лемму, используйте в шаблоне для токена атрибут `"LEMMA"`. Например, 
  шаблону `{"LEMMA": "be"}` будут соответствовать такие токены, как "is", "was" и "being".
- Чтобы найти имена собственные, нужно искать такие токены, для которых значение атрибута 
  `"POS"` равен`"PROPN"`.

</codeblock>

### Часть 3

- Напишите **один** шаблон, которому соответствует прилагательное (`"ADJ"`), 
  за которым следует последовательность из одного или двух существительных (`"NOUN"`)
  (одно обязательное существительное и одно опциональное).

<codeblock id="01_12_03">

- Чтобы найти прилагательные, нужно искать такие токены, 
  для которых значение атрибута `"POS"` равен `"ADJ"`. В случае с существительными, 
  нужно искать `"NOUN"`.
- Операторы добавляются по ключу `"OP"`. Например, `"OP": "?"` позвоялет не включать токен 
  вовсе или включить 1 раз.

</codeblock>

</exercise>
